apiVersion: 1

datasources:
  # Elasticsearch - Security Events & Logs
  - name: Elasticsearch
    type: elasticsearch
    access: proxy
    url: http://elasticsearch:9200
    database: "[security-events-]YYYY.MM.DD"
    jsonData:
      timeField: "@timestamp"
      esVersion: "8.0.0"
      logMessageField: message
      logLevelField: level
      interval: Daily
      timeInterval: "10s"
    editable: true

  # Elasticsearch - Threat Alerts
  - name: Elasticsearch-Threats
    type: elasticsearch
    access: proxy
    url: http://elasticsearch:9200
    database: "threat-alerts"
    jsonData:
      timeField: "@timestamp"
      esVersion: "8.0.0"
      logMessageField: description
      logLevelField: severity
      timeInterval: "5s"
    editable: true

  # Elasticsearch - Wazuh Alerts
  - name: Elasticsearch-Wazuh
    type: elasticsearch
    access: proxy
    url: http://elasticsearch:9200
    database: "[wazuh-alerts-]YYYY.MM.DD"
    jsonData:
      timeField: "timestamp"
      esVersion: "8.0.0"
      logMessageField: "rule.description"
      logLevelField: "rule.level"
      interval: Daily
      timeInterval: "10s"
    editable: true

  # Prometheus - System & Container Metrics
  - name: Prometheus
    type: prometheus
    access: proxy
    url: http://prometheus:9090
    jsonData:
      timeInterval: "15s"
      queryTimeout: "60s"
      httpMethod: POST
    editable: true

  # Loki - Log Aggregation
  - name: Loki
    type: loki
    access: proxy
    url: http://loki:3100
    jsonData:
      maxLines: 1000
      derivedFields:
        - datasourceUid: Prometheus
          matcherRegex: "container_id=(\\w+)"
          name: container_id
          url: "/explore?left=[\"now-1h\",\"now\",\"Prometheus\",{\"expr\":\"container_memory_usage_bytes{container_id=\\\"$${__value.raw}\\\"}\"}]"
    editable: true

  # MySQL - MISP Database
  - name: MISP-Database
    type: mysql
    access: proxy
    url: misp-db:3306
    database: misp
    user: misp
    secureJsonData:
      password: misp_password
    jsonData:
      maxOpenConns: 10
      maxIdleConns: 10
      connMaxLifetime: 14400
    editable: true

  # TestData for Demo/Testing
  - name: TestData
    type: testdata
    access: proxy
    editable: false
    jsonData:
      streamingIntervals:
        - 100ms
        - 200ms
        - 500ms
